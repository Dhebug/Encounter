;Smoke.s - Smoke Engine



ProcSmoke	lda SmokeFrac
	adc #96
	sta SmokeFrac
.(
	bcc skip1
	ldx #31
loop1	jsr DeleteSmokeParticle
	jsr MoveSmokeParticle
	jsr PlotSmokeParticle
	dex
	bpl loop1
skip1	rts
.)

DeleteSmokeParticle
	ldy Smoke_y,x
	lda SYLocl,y
	ldy Smoke_x,x
	clc
	adc Smoke_xloc,y
	sta screen
	ldy Smoke_y,x
	lda SYLoch,y
	adc #00
	sta screen+1
	ldy Smoke_x,x
	lda Smoke_xbit,y
	ora Smoke_xbit+2,y
	ldy #40
	eor #63
	and (screen),y
	sta (screen),y
	rts


MoveSmokeParticle
	lda Smoke_x,x
	eor #1
	sta Smoke_x,x
	lda Smoke_Frac,x
	adc Smoke_Speed,x
	sta Smoke_Frac,x
	lda Smoke_y,x
	sbc #01
	sta Smoke_y,x

.(
	bpl skip1
	;Set position
	lda SmokeWidth
	jsr game_GetRNDRange
	clc
	adc SmokeLeft
	sta Smoke_x,x
	lda SmokeBottom
	sta Smoke_y,x
	;Set speed
	lda #255
	jsr game_GetRNDRange
	sta Smoke_Speed,x
skip1	rts
.)


PlotSmokeParticle
	ldy Smoke_y,x
	lda SYLocl,y
	ldy Smoke_x,x
	clc
	adc Smoke_xloc,y
	sta screen
	ldy Smoke_y,x
	lda SYLoch,y
	adc #00
	sta screen+1
	ldy Smoke_x,x
	lda Smoke_xbit,y
	;ora Smoke_xbit+2,y
	ldy #40
	ora (screen),y
	sta (screen),y
	rts

Smoke_x	.dsb 32,0
Smoke_y	.dsb 32,0
Smoke_Speed	.dsb 32,5
Smoke_Frac	.dsb 32,123
SmokeFrac	.byt 0

Smoke_xbit
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
 .byt %01100000
 .byt %01010000
 .byt %01001000
 .byt %01000100
 .byt %01000010
 .byt %01000001
Smoke_xloc
 .dsb 6,0
 .dsb 6,1
 .dsb 6,2
 .dsb 6,3
 .dsb 6,4
 .dsb 6,5
 .dsb 6,6
 .dsb 6,7
 .dsb 6,8
 .dsb 6,9
 .dsb 6,10
 .dsb 6,11
 .dsb 6,12
 .dsb 6,13
 .dsb 6,14
 .dsb 6,15
 .dsb 6,16
 .dsb 6,17
 .dsb 6,18
 .dsb 6,19
 .dsb 6,20
 .dsb 6,21
 .dsb 6,22
 .dsb 6,23
 .dsb 6,24
 .dsb 6,25
 .dsb 6,26
 .dsb 6,27
 .dsb 6,28
 .dsb 6,29
 .dsb 6,30
 .dsb 6,31
 .dsb 6,32
 .dsb 6,33
 .dsb 6,34
 .dsb 6,35
 .dsb 6,36
 .dsb 6,37
 .dsb 6,38
 .dsb 6,39

SYLocl
 .byt <$a758
 .byt <$a758+80*1
 .byt <$a758+80*2
 .byt <$a758+80*3
 .byt <$a758+80*4
 .byt <$a758+80*5
 .byt <$a758+80*6
 .byt <$a758+80*7
 .byt <$a758+80*8
 .byt <$a758+80*9
 .byt <$a758+80*10
 .byt <$a758+80*11
 .byt <$a758+80*12
 .byt <$a758+80*13
 .byt <$a758+80*14
 .byt <$a758+80*15
 .byt <$a758+80*16
 .byt <$a758+80*17
 .byt <$a758+80*18
 .byt <$a758+80*19
 .byt <$a758+80*20
 .byt <$a758+80*21
 .byt <$a758+80*22
 .byt <$a758+80*23
 .byt <$a758+80*24
 .byt <$a758+80*25
 .byt <$a758+80*26
 .byt <$a758+80*27
 .byt <$a758+80*28
 .byt <$a758+80*29
 .byt <$a758+80*30
 .byt <$a758+80*31
 .byt <$a758+80*32
 .byt <$a758+80*33
 .byt <$a758+80*34
 .byt <$a758+80*35
 .byt <$a758+80*36
 .byt <$a758+80*37
 .byt <$a758+80*38
 .byt <$a758+80*39
 .byt <$a758+80*40
 .byt <$a758+80*41
 .byt <$a758+80*42
 .byt <$a758+80*43
 .byt <$a758+80*44
 .byt <$a758+80*45
 .byt <$a758+80*46
 .byt <$a758+80*47
 .byt <$a758+80*48
 .byt <$a758+80*49
 .byt <$a758+80*50
 .byt <$a758+80*51
 .byt <$a758+80*52
 .byt <$a758+80*53
 .byt <$a758+80*54
 .byt <$a758+80*55
 .byt <$a758+80*56
 .byt <$a758+80*57
 .byt <$a758+80*58
 .byt <$a758+80*59
SYLoch
 .byt >$a758
 .byt >$a758+80*1
 .byt >$a758+80*2
 .byt >$a758+80*3
 .byt >$a758+80*4
 .byt >$a758+80*5
 .byt >$a758+80*6
 .byt >$a758+80*7
 .byt >$a758+80*8
 .byt >$a758+80*9
 .byt >$a758+80*10
 .byt >$a758+80*11
 .byt >$a758+80*12
 .byt >$a758+80*13
 .byt >$a758+80*14
 .byt >$a758+80*15
 .byt >$a758+80*16
 .byt >$a758+80*17
 .byt >$a758+80*18
 .byt >$a758+80*19
 .byt >$a758+80*20
 .byt >$a758+80*21
 .byt >$a758+80*22
 .byt >$a758+80*23
 .byt >$a758+80*24
 .byt >$a758+80*25
 .byt >$a758+80*26
 .byt >$a758+80*27
 .byt >$a758+80*28
 .byt >$a758+80*29
 .byt >$a758+80*30
 .byt >$a758+80*31
 .byt >$a758+80*32
 .byt >$a758+80*33
 .byt >$a758+80*34
 .byt >$a758+80*35
 .byt >$a758+80*36
 .byt >$a758+80*37
 .byt >$a758+80*38
 .byt >$a758+80*39
 .byt >$a758+80*40
 .byt >$a758+80*41
 .byt >$a758+80*42
 .byt >$a758+80*43
 .byt >$a758+80*44
 .byt >$a758+80*45
 .byt >$a758+80*46
 .byt >$a758+80*47
 .byt >$a758+80*48
 .byt >$a758+80*49
 .byt >$a758+80*50
 .byt >$a758+80*51
 .byt >$a758+80*52
 .byt >$a758+80*53
 .byt >$a758+80*54
 .byt >$a758+80*55
 .byt >$a758+80*56
 .byt >$a758+80*57
 .byt >$a758+80*58
 .byt >$a758+80*59
